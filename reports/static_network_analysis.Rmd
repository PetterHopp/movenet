---
title: "Static network analysis"
---

```{r setup, include = FALSE}
library(dplyr)
library(igraph)
library(magrittr)
truenames <- colnames(data)
colnames(data)[1:4]<-c("origin_ID","dest_ID","move_date","nr_pigs")
#can reset names of edge attributes with names(edge_attr(g))<-truenames[-c(1,2)]
```

```{r create_graph, include = FALSE}

g <- graph_from_data_frame(data,directed=TRUE)

E(g)$weight <- data$nr_pigs

```

## Full graph: repeated edges (movements) are considered separately

```{r plot graph, echo = FALSE}
plot(g)
```

Network size (number of nodes): `r vcount(g)`

Network order (number of edges): `r ecount(g)`

## Simplified graph: combining all repeated edges (movements)

```{r simplify graph, echo = FALSE}
#Overall movement summary (nr_pigs summed over all repeated edges)
g_moves_summed <- simplify(g, remove.multiple = TRUE, edge.attr.comb = list(nr_pigs = "sum", weight = "sum", "ignore"))
#Mean (or median) number of pigs moved between each set of vertices
g_moves_mean <- simplify(g, remove.multiple = TRUE, edge.attr.comb = list(nr_pigs = "mean", weight = "mean", "ignore"))
g_moves_median <- simplify(g, remove.multiple = TRUE, edge.attr.comb = list(nr_pigs = "median", weight = "median", "ignore"))
```

```{r plot simplified graph, echo = FALSE}
plot(g_moves_summed)
```

Network size (number of nodes): `r vcount(g_moves_summed)`

Network order (number of edges): `r ecount(g_moves_summed)`

## Centrality

### Degree centrality (all, in, out)
```{r degree distribution, echo = FALSE}
plot(degree_distribution(g, mode = "all", cumulative = TRUE)[-1], log="xy", ylab = "CCDF", xlab = "Degree") #[-1] to exclude degree = 0, and make "index" (original x axis, starting with 1 = degree 0) equal to degree
plot(degree_distribution(g, mode = "in", cumulative = TRUE)[-1], log="xy", ylab = "CCDF", xlab = "Indegree")
plot(degree_distribution(g, mode = "out", cumulative = TRUE)[-1], log="xy", ylab = "CCDF", xlab = "Outdegree")
```

### Closeness centrality (all)
```{r closeness, echo = FALSE}
hist(closeness(g, mode = "all"))
```

### Betweenness centrality (weighted by nr pigs - prob wrong way)
```{r betweenness, echo = FALSE}
hist(betweenness(g))
```

## Components
Whether the graph is strongly connected?
```{r components, echo = FALSE}
is_connected(g) 
components(g)
```

